<div class="container">
  <mat-card>
    <!-- Success form when token is valid -->
    <mat-card-header *ngIf="tokenValid">
      <mat-card-title>Đặt lại mật khẩu</mat-card-title>
    </mat-card-header>

    <mat-card-content *ngIf="tokenValid">
      <form (ngSubmit)="resetPassword()">
        <!-- New Password Field -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Mật khẩu mới</mat-label>
          <input matInput 
                type="password" 
                id="password" 
                [(ngModel)]="newPassword" 
                name="password" 
                (input)="clearMessage()" 
                required
                minlength="6">
          <mat-icon matSuffix>lock</mat-icon>
          <mat-error *ngIf="message">{{ message }}</mat-error>
          <mat-hint>Ít nhất 6 ký tự</mat-hint>
        </mat-form-field>

        <!-- Confirm Password Field -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nhập lại mật khẩu</mat-label>
          <input matInput 
                type="password" 
                id="confirmPassword" 
                [(ngModel)]="confirmPassword" 
                name="confirmPassword" 
                (input)="clearMessage()" 
                required>
          <mat-icon matSuffix>lock_reset</mat-icon>
          <mat-error *ngIf="confirmMessage">{{ confirmMessage }}</mat-error>
        </mat-form-field>

        <!-- Submit Button with Loading -->
        <button mat-raised-button 
                color="primary" 
                type="submit"
                [disabled]="isProcessing || isButtonDisabled()"
                class="submit-button">
          <span *ngIf="!isProcessing">Xác nhận</span>
          <span *ngIf="isProcessing" class="button-loading">
            <mat-spinner diameter="20"></mat-spinner>
            Đang xử lý...
          </span>
        </button>
      </form>
    </mat-card-content>

    <!-- Error message when token is invalid -->
    <mat-card-content *ngIf="!tokenValid" class="error-container">
      <mat-card-header>
        <mat-card-title>Lỗi</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>{{ errorMessage }}</p>
        <button mat-raised-button color="warn" (click)="router.navigate(['/forget-password'])">
          Yêu cầu liên kết mới
        </button> 
      </mat-card-content>
    </mat-card-content>
  </mat-card>
</div>