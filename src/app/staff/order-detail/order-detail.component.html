<div class="order-detail-container" *ngIf="order">
    <div class="header">
        <button mat-icon-button routerLink="/staff">
            <mat-icon>arrow_back</mat-icon>
        </button>
        <h1>Chi tiết đơn hàng #{{order.id}}</h1>
        <div class="status-chip">
            <mat-chip [ngClass]="getStatusClass(order.status)">
                {{getStatusText(order.status)}}
            </mat-chip>
        </div>
    </div>

    <mat-divider></mat-divider>

    <div class="order-sections">
        <!-- Customer Information -->
        <div class="section">
            <h2>Thông tin khách hàng</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="label">Tên khách hàng:</span>
                    <span class="value">{{order.customerName}}</span>
                </div>
                <div class="info-item">
                    <span class="label">Số điện thoại:</span>
                    <span class="value">{{order.phoneNumber}}</span>
                </div>
                <div class="info-item">
                    <span class="label">Email:</span>
                    <span class="value">{{order.email}}</span>
                </div>
                <div class="info-item">
                    <span class="label">Địa chỉ giao hàng:</span>
                    <span class="value">{{order.shippingAddress}}</span>
                </div>
            </div>
        </div>

        <!-- THông tin shipper -->
        <div class="section" *ngIf="order.deliveryName">
            <h2>Thông tin giao hàng</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="label">Nhân viên giao hàng:</span>
                    <span class="value">{{order.deliveryName}}</span>
                </div>
                <!-- Có thể thêm các thông tin khác nếu cần -->
                <div class="info-item" *ngIf="order.deliveryAt">
                    <span class="label">Thời gian bắt đầu giao:</span>
                    <span class="value">{{order.deliveryAt | date:'dd/MM/yyyy HH:mm'}}</span>
                </div>

                <div class="info-item" *ngIf="order.completedAt">
                    <span class="label">Thời gian hoàn thành:</span>
                    <span class="value">{{order.completedAt | date:'dd/MM/yyyy HH:mm'}}</span>
                </div>
            </div>
        </div>

        <!-- Order Items -->
        <div class="section">
            <h2>Sản phẩm đã đặt</h2>
            <table mat-table [dataSource]="order.items" class="mat-elevation-z1">
                <!-- Product Column -->
                <ng-container matColumnDef="product">
                    <th mat-header-cell *matHeaderCellDef>Sản phẩm</th>
                    <td mat-cell *matCellDef="let item">
                        <div class="product-info">
                            <div class="name">{{item.name}}</div>
                            <div class="price">{{item.price | currency:'VND':'symbol':'1.0-0'}}</div>
                        </div>
                    </td>
                </ng-container>

                <!-- Quantity Column -->
                <ng-container matColumnDef="quantity">
                    <th mat-header-cell *matHeaderCellDef>Số lượng</th>
                    <td mat-cell *matCellDef="let item">{{item.quantity}}</td>
                </ng-container>

                <!-- Total Column -->
                <ng-container matColumnDef="total">
                    <th mat-header-cell *matHeaderCellDef>Thành tiền</th>
                    <td mat-cell *matCellDef="let item">
                        {{(item.price * item.quantity) | currency:'VND':'symbol':'1.0-0'}}
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="['product', 'quantity', 'total']"></tr>
                <tr mat-row *matRowDef="let row; columns: ['product', 'quantity', 'total'];"></tr>
            </table>
        </div>

        <!-- Order Summary -->
        <div class="section">
            <h2>Tổng hợp đơn hàng</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <span class="label">Ngày đặt hàng:</span>
                    <span class="value">{{order.orderDate | date:'dd/MM/yyyy HH:mm'}}</span>
                </div>
                <div class="summary-item">
                    <span class="label">Tổng tiền hàng:</span>
                    <span class="value">{{order.totalPrice | currency:'VND':'symbol':'1.0-0'}}</span>
                </div>
                <div class="summary-item">
                    <span class="label">Giảm giá:</span>
                    <span class="value">-{{order.discountAmount | currency:'VND':'symbol':'1.0-0'}}</span>
                </div>
                <div class="summary-item">
                    <span class="label">Phí vận chuyển:</span>
                    <span class="value">{{order.shippingFee | currency:'VND':'symbol':'1.0-0'}}</span>
                </div>
                <div class="summary-item total">
                    <span class="label">Tổng thanh toán:</span>
                    <span class="value">{{order.finalAmount | currency:'VND':'symbol':'1.0-0'}}</span>
                </div>
            </div>
        </div>

        <!-- Payment Information -->
        <!-- Payment Information -->
        <div class="section" *ngIf="order.payment">
            <h2>Thông tin thanh toán</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="label">Phương thức:</span>
                    <span class="value">{{getPaymentMethodText(order.payment.paymentMethod)}}</span>
                </div>
                <div class="info-item">
                    <span class="label">Trạng thái:</span>
                    <span class="value">
                        <mat-chip [ngClass]="getPaymentStatusClass(order.payment.status)">
                            {{getPaymentStatusText(order.payment.status)}}
                        </mat-chip>
                    </span>
                </div>
                <div class="info-item">
                    <span class="label">Số tiền:</span>
                    <span class="value">{{order.payment.amount | currency:'VND':'symbol':'1.0-0'}}</span>
                </div>
                <div class="info-item" *ngIf="order.payment.paymentDate">
                    <span class="label">Thời gian thanh toán:</span>
                    <span class="value">{{order.payment.paymentDate | date:'dd/MM/yyyy HH:mm'}}</span>
                </div>
                <div class="info-item" *ngIf="order.payment.transactionId">
                    <span class="label">Mã giao dịch:</span>
                    <span class="value">{{order.payment.transactionId}}</span>
                </div>
            </div>
        </div>

        <!-- Staff Actions -->
        <div class="actions" *ngIf="order.status === 'PENDING'">
            <button mat-raised-button color="primary" (click)="assignDelivery(order)">
                <mat-icon>assignment</mat-icon> Phân công giao hàng
            </button>
            <button mat-raised-button style="margin-left: 10px;" color="warn" (click)="openCancelDialog(order)"
                *ngIf="order.status === 'PENDING' || order.status === 'PLACED'">
                <mat-icon>cancel</mat-icon> Hủy đơn hàng
            </button>
        </div>
    </div>
</div>