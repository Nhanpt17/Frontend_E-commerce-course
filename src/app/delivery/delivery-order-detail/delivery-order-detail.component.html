<div class="order-detail-container" *ngIf="order">
    <div class="header">
      <button mat-icon-button routerLink="/delivery">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1>Chi tiết đơn hàng #{{order.id}}</h1>
      <div class="status-chip">
        <mat-chip [ngClass]="getStatusClass(order.status)">
          {{getStatusText(order.status)}}
        </mat-chip>
      </div>
    </div>
  
    <mat-divider></mat-divider>
  
    <div class="order-sections">
      <!-- Customer Information -->
      <div class="section">
        <h2>Thông tin khách hàng</h2>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Tên khách hàng:</span>
            <span class="value">{{order.customerName}}</span>
          </div>
          <div class="info-item">
            <span class="label">Số điện thoại:</span>
            <span class="value">{{order.phoneNumber}}</span>
          </div>
          <div class="info-item">
            <span class="label">Địa chỉ giao hàng:</span>
            <span class="value">{{order.shippingAddress}}</span>
          </div>
        </div>
      </div>
  
      <!-- Order Items -->
      <div class="section">
        <h2>Sản phẩm đã đặt</h2>
        <table mat-table [dataSource]="order.items" class="mat-elevation-z1">
          <!-- Product Column -->
          <ng-container matColumnDef="product">
            <th mat-header-cell *matHeaderCellDef>Sản phẩm</th>
            <td mat-cell *matCellDef="let item">
              <div class="product-info">
                <div class="name">{{item.name}}</div>
                <div class="price">{{item.price | currency:'VND':'symbol':'1.0-0'}}</div>
              </div>
            </td>
          </ng-container>
  
          <!-- Quantity Column -->
          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef>Số lượng</th>
            <td mat-cell *matCellDef="let item">{{item.quantity}}</td>
          </ng-container>
  
          <!-- Total Column -->
          <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef>Thành tiền</th>
            <td mat-cell *matCellDef="let item">
              {{(item.price * item.quantity) | currency:'VND':'symbol':'1.0-0'}}
            </td>
          </ng-container>
  
          <tr mat-header-row *matHeaderRowDef="['product', 'quantity', 'total']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['product', 'quantity', 'total'];"></tr>
        </table>
      </div>
      
      <!-- Order Summary -->
    <div class="section">
      <h2>Tổng hợp đơn hàng</h2>
      <div class="summary-grid">
        <div class="summary-item">
          <span class="label">Tổng tiền hàng:</span>
          <span class="value">{{order.totalPrice | currency:'VND':'symbol':'1.0-0'}}</span>
        </div>
        <div class="summary-item">
          <span class="label">Giảm giá:</span>
          <span class="value">-{{order.discountAmount | currency:'VND':'symbol':'1.0-0'}}</span>
        </div>
        <div class="summary-item">
          <span class="label">Phí vận chuyển:</span>
          <span class="value">+{{order.shippingFee | currency:'VND':'symbol':'1.0-0'}}</span>
        </div>
        <div class="summary-item total">
          <span class="label">Tổng thanh toán:</span>
          <span class="value">{{order.finalAmount | currency:'VND':'symbol':'1.0-0'}}</span>
        </div>
      </div>
    </div>


    <!-- Payment Information  -->
    <div class="section" *ngIf="order.payment">
      <h2>Thông tin thanh toán</h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Phương thức:</span>
          <span class="value">{{order.payment.paymentMethod === 'CASH' ? 'Tiền mặt khi nhận hàng' : 'Đã thanh toán online'}}</span>
        </div>
        <div class="info-item" *ngIf="order.payment.paymentMethod === 'CASH'">
          <span class="label">Số tiền thu hộ:</span>
          <span class="value">{{order.finalAmount | currency:'VND':'symbol':'1.0-0'}}</span>
        </div>
      </div>
    </div>

       <!-- Delivery Actions -->
    <div class="actions">
      <div class="payment-reminder" *ngIf="order.payment?.paymentMethod === 'CASH'">
        <mat-icon>info</mat-icon>
        <span>Nhớ thu đúng số tiền: <strong>{{order.finalAmount | currency:'VND':'symbol':'1.0-0'}}</strong></span>
      </div>

      <button mat-raised-button color="primary" 
              (click)="updateOrderStatus(order, orderStatus.DELIVERING)"
              *ngIf="order.status === 'PLACED'">
        <mat-icon>directions_bike</mat-icon> Nhận đơn giao
      </button>
      
      <button mat-raised-button color="primary" 
              (click)="updateOrderStatus(order, orderStatus.COMPLETED)"
              *ngIf="order.status === 'DELIVERING'">
        <mat-icon>done_all</mat-icon> Xác nhận đã giao
      </button>
    </div>
    </div>
  </div>